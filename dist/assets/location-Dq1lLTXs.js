import{j as e,a4 as O,a5 as S,B as R,T as L,i as V,aj as F,o as A,aq as X,ar as w,as as Y,ao as C,am as $,an as W,av as q,a1 as k,X as B,r as h,ak as I,al as J,a7 as Z,K as N,I as v,Y as D,Z as ee,$ as _,a0 as G,a8 as se,a9 as ne,aa as re,ab as oe,a2 as ie,ac as K,p as te,C as ce,ad as le,ae,af as de,ag as E,ah as ue,ai as ge,H as he,q as pe}from"./index-Ca9vWsGo.js";function xe({searchQuery:s,...n}){return e.jsx(O,{...n,children:e.jsx(S,{align:"center",colSpan:7,children:e.jsxs(R,{sx:{py:15,textAlign:"center"},children:[e.jsx(L,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(L,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',s,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function me({emptyRows:s,height:n,sx:r,...i}){return s?e.jsx(O,{sx:{...n&&{height:n*s},...r},...i,children:e.jsx(S,{colSpan:9})}):null}const je=({setOpen:s,locationData:n})=>{const r=V(),i=F(),{isLoading:g}=A(j=>j.loader),t=X().shape({region:w().required("Region is required"),city:w().required("City is required")}),d=Y({initialValues:{region:(n==null?void 0:n.region)??"",city:(n==null?void 0:n.city)??""},validationSchema:t,onSubmit:async j=>{try{i(C(!0));const P={region:j.region,city:j.city},u=$.updateLocation(P,(n==null?void 0:n._id)??(n==null?void 0:n.id));W.promise(u,{pending:{render(){return"Loading. Please wait..."},icon:!1},success:{render({data:a}){var l;i(C(!1)),q("/admins/locations/all");const f=((l=a==null?void 0:a.data)==null?void 0:l.message)||"Location updated successfully";return s(!1),`${f}`}},error:{render({data:a}){var l,x,m,p;return i(C(!1)),console.log("ERRO ON TOAST HERE :: ",(x=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:x.message),`${(((p=(m=a==null?void 0:a.response)==null?void 0:m.data)==null?void 0:p.message)||(a==null?void 0:a.message)||"")??"An error occurred!"}`}}})}catch(P){i(C(!1)),console.log("LOCATION ERR :: ",P)}}}),{touched:o,errors:c,getFieldProps:b,handleSubmit:y}=d;return e.jsxs(R,{p:3,minWidth:320,children:[e.jsx(k,{variant:"outlined",fullWidth:!0,placeholder:"Region",label:"Region",...b("region"),error:!!(o.region&&c.region),helperText:!!(o.region&&c.region)}),e.jsx(R,{p:1}),e.jsx(k,{variant:"outlined",fullWidth:!0,placeholder:"City",label:"City",...b("city"),error:!!(o.city&&c.city),helperText:!!(o.city&&c.city)}),e.jsx(R,{p:2}),e.jsx(B,{fullWidth:!0,disabled:g,variant:"contained",onClick:()=>y(),sx:{bgcolor:r.palette.secondary.main},children:"Update Now"})]})};function fe({row:s,selected:n,onSelectRow:r}){const i=F(),[g,t]=h.useState(!1),[d,o]=h.useState(!1),[c,b]=h.useState(""),[y,j]=h.useState(""),[P,u]=h.useState(null),{profile:a}=A(m=>m.auth),f=h.useCallback(m=>{u(m.currentTarget)},[]),l=h.useCallback(()=>{u(null)},[]),x=()=>{const m=$.deleteLocation((s==null?void 0:s._id)??(s==null?void 0:s.id));W.promise(m,{pending:{render(){return"Loading. Please wait..."},icon:!1},success:{render({data:p}){var T;i(C(!1)),q("/admins/locations/all");const M=((T=p==null?void 0:p.data)==null?void 0:T.message)||"Location deleted successfully";return t(!1),`${M}`}},error:{render({data:p}){var T,H,z,U;return i(C(!1)),console.log("ERRO ON TOAST HERE :: ",(H=(T=p==null?void 0:p.response)==null?void 0:T.data)==null?void 0:H.message),`${(((U=(z=p==null?void 0:p.response)==null?void 0:z.data)==null?void 0:U.message)||(p==null?void 0:p.message)||"")??"An error occurred!"}`}}})};return e.jsxs(e.Fragment,{children:[e.jsx(I,{open:d,setOpen:o,title:"Update Location",body:e.jsx(je,{setOpen:o,locationData:s})}),e.jsx(I,{open:g,setOpen:t,title:c,body:e.jsx(J,{setOpen:t,message:y,action:()=>x()})}),e.jsxs(O,{hover:!0,tabIndex:-1,role:"checkbox",selected:n,children:[e.jsx(S,{padding:"checkbox",children:e.jsx(Z,{disableRipple:!0,checked:n,onChange:r})}),e.jsx(S,{children:s.region}),e.jsx(S,{children:s.city}),e.jsx(S,{align:"right",children:e.jsx(N,{onClick:f,children:e.jsx(v,{icon:"eva:more-vertical-fill"})})})]}),e.jsx(D,{open:!!P,anchorEl:P,onClose:l,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ee,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${_.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${_.selected}`]:{bgcolor:"action.selected"}}},children:a&&(a==null?void 0:a.role)!=="support"&&e.jsxs(e.Fragment,{children:[e.jsxs(G,{onClick:()=>{l(),o(!0)},sx:{color:"info.main"},children:[e.jsx(v,{icon:"akar-icons:edit"}),"Update"]}),e.jsxs(G,{onClick:()=>{b("Delete Location"),j("Are you sure you want to delete this location? Action is irreversible."),l(),t(!0)},sx:{color:"error.main"},children:[e.jsx(v,{icon:"fluent:person-delete-24-filled"}),"Delete"]})]})})})]})}const be={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function ye(s,n,r){return s?Math.max(0,(1+s)*n-r):0}function Q(s,n,r){return n[r]<s[r]?-1:n[r]>s[r]?1:0}function Pe(s,n){return s==="desc"?(r,i)=>Q(r,i,n):(r,i)=>-Q(r,i,n)}function Ce({inputData:s,comparator:n,filterName:r}){const i=s.map((g,t)=>[g,t]);return i.sort((g,t)=>{const d=n(g[0],t[0]);return d!==0?d:g[1]-t[1]}),s=i.map(g=>g[0]),r&&(s=s.filter(g=>`${g.region} ${g.city}`.toLowerCase().indexOf(r.toLowerCase())!==-1)),s}function Re({order:s,onSort:n,orderBy:r,rowCount:i,headLabel:g,numSelected:t,onSelectAllRows:d}){return e.jsx(se,{children:e.jsxs(O,{children:[e.jsx(S,{padding:"checkbox",children:e.jsx(Z,{indeterminate:t>0&&t<i,checked:i>0&&t===i,onChange:o=>d(o.target.checked)})}),g.map(o=>e.jsx(S,{align:o.align||"left",sortDirection:r===o.id?s:!1,sx:{width:o.width,minWidth:o.minWidth},children:e.jsxs(ne,{hideSortIcon:!0,active:r===o.id,direction:r===o.id?s:"asc",onClick:()=>n(o.id),children:[o.label,r===o.id?e.jsx(R,{sx:{...be},children:s==="desc"?"sorted descending":"sorted ascending"}):null]})},o.id))]})})}function Se({numSelected:s,filterName:n,onFilterName:r}){return e.jsxs(re,{sx:{height:96,display:"flex",justifyContent:"space-between",p:i=>i.spacing(0,1,0,3),...s>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[s>0?e.jsxs(L,{component:"div",variant:"subtitle1",children:[s," selected"]}):e.jsx(oe,{fullWidth:!0,value:n,onChange:r,placeholder:"Search location...",startAdornment:e.jsx(ie,{position:"start",children:e.jsx(v,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),s>0?e.jsx(K,{title:"Delete",children:e.jsx(N,{children:e.jsx(v,{icon:"solar:trash-bin-trash-bold"})})}):e.jsx(K,{title:"Filter list",children:e.jsx(N,{children:e.jsx(v,{icon:"ic:round-filter-list"})})})]})}function ve(){const s=Te(),[n,r]=h.useState(!1),[i,g]=h.useState(""),{locations:t}=A(c=>c.misc),d=Ce({inputData:t,comparator:Pe(s.order,s.orderBy),filterName:i}),o=!d.length&&!!i;return e.jsxs(te,{children:[e.jsx(I,{open:n,setOpen:r,title:"Add New Location",body:e.jsx(Le,{setOpen:r})}),e.jsxs(R,{display:"flex",alignItems:"center",mb:5,children:[e.jsx(L,{variant:"h4",flexGrow:1,children:"Locations"}),e.jsx(B,{variant:"contained",color:"inherit",onClick:()=>r(!0),startIcon:e.jsx(v,{icon:"mingcute:add-line"}),children:"New Location"})]}),e.jsxs(ce,{children:[e.jsx(Se,{numSelected:s.selected.length,filterName:i,onFilterName:c=>{g(c.target.value),s.onResetPage()}}),e.jsx(le,{children:e.jsx(ae,{sx:{overflow:"unset"},children:e.jsxs(de,{sx:{minWidth:800},children:[e.jsx(Re,{order:s.order,orderBy:s.orderBy,rowCount:E.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:c=>s.onSelectAllRows(c,E.map(b=>b.id)),headLabel:[{id:"region",label:"Region"},{id:"city",label:"City"},{id:""}]}),e.jsxs(ue,{children:[d.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(c=>e.jsx(fe,{row:c,selected:s.selected.includes(c.id),onSelectRow:()=>s.onSelectRow(c.id)},c.id)),e.jsx(me,{height:68,emptyRows:ye(s.page,s.rowsPerPage,E.length)}),o&&e.jsx(xe,{searchQuery:i})]})]})})}),e.jsx(ge,{component:"div",page:s.page,count:t==null?void 0:t.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:s.onChangeRowsPerPage})]})]})}function Te(){const[s,n]=h.useState(0),[r,i]=h.useState("name"),[g,t]=h.useState(5),[d,o]=h.useState([]),[c,b]=h.useState("asc"),y=h.useCallback(l=>{b(r===l&&c==="asc"?"desc":"asc"),i(l)},[c,r]),j=h.useCallback((l,x)=>{if(l){o(x);return}o([])},[]),P=h.useCallback(l=>{const x=d.includes(l)?d.filter(m=>m!==l):[...d,l];o(x)},[d]),u=h.useCallback(()=>{n(0)},[]),a=h.useCallback((l,x)=>{n(x)},[]),f=h.useCallback(l=>{t(parseInt(l.target.value,10)),u()},[u]);return{page:s,order:c,onSort:y,orderBy:r,selected:d,rowsPerPage:g,onSelectRow:P,onResetPage:u,onChangePage:a,onSelectAllRows:j,onChangeRowsPerPage:f}}const Le=({setOpen:s})=>{const n=V(),r=F(),{isLoading:i}=A(y=>y.loader),g=X().shape({region:w().required("Region is required"),city:w().required("City is required")}),t=Y({initialValues:{region:"",city:""},validationSchema:g,onSubmit:async y=>{try{r(C(!0));const j={region:y.region,city:y.city},P=$.addLocation(j);W.promise(P,{pending:{render(){return"Loading. Please wait..."},icon:!1},success:{render({data:u}){var f;r(C(!1)),q("/admins/locations/all");const a=((f=u==null?void 0:u.data)==null?void 0:f.message)||"New location added successfully";return s(!1),`${a}`}},error:{render({data:u}){var f,l,x,m;return r(C(!1)),console.log("ERRO ON TOAST HERE :: ",(l=(f=u==null?void 0:u.response)==null?void 0:f.data)==null?void 0:l.message),`${(((m=(x=u==null?void 0:u.response)==null?void 0:x.data)==null?void 0:m.message)||(u==null?void 0:u.message)||"")??"An error occurred!"}`}}})}catch(j){r(C(!1)),console.log("LOCATION ERR :: ",j)}}}),{touched:d,errors:o,getFieldProps:c,handleSubmit:b}=t;return e.jsxs(R,{p:3,minWidth:320,children:[e.jsx(k,{variant:"outlined",fullWidth:!0,placeholder:"Region",label:"Region",...c("region"),error:!!(d.region&&o.region),helperText:d.region&&o.region}),e.jsx(R,{p:1}),e.jsx(k,{variant:"outlined",fullWidth:!0,placeholder:"City",label:"City",...c("city"),error:!!(d.city&&o.city),helperText:d.city&&o.city}),e.jsx(R,{p:2}),e.jsx(B,{fullWidth:!0,disabled:i,variant:"contained",onClick:()=>b(),sx:{bgcolor:n.palette.secondary.main},children:"Submit"})]})};function ke(){return e.jsxs(e.Fragment,{children:[e.jsx(he,{children:e.jsxs("title",{children:[" ",`Locations - ${pe.appName}`]})}),e.jsx(ve,{})]})}export{ke as default};
